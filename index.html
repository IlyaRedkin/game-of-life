<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Game of life</title>
  <link rel="stylesheet" href="index.css">
</head>
<body>
<h1>Game of Life</h1>
<script type="text/javascript" src="utils.js"></script>
<script type="text/javascript" src="figures/glider.js"></script>
<script type="text/javascript" src="figures/planner.js"></script>
<script type="text/javascript" src="index.js"></script>
<script type="text/javascript" src="canvas.js"></script>
<script>
  // defaults
  let widthPx = 1000;
  let heightPx = 1000;
  let cellSizePx = 10;
  const borderWidth = cellSizePx/10;
</script>
<script>
  window.onload = function () {
    initPage();
  };

  // let scrollContainer
  let canvasContext
  let from = {x: 0, y: 0}
  let to = {x: widthPx, y: heightPx}

  function initPage() {
    // scrollContainer = document.querySelector("#scroll-container");
    // canvasContext = getCanvasContext({width: scrollContainer?.clientWidth || 1000, height: scrollContainer?.clientHeight || 1000})
    canvasContext = getCanvasContext({width: widthPx, height: heightPx})

    // scrollContainer.addEventListener("scroll", (event) => {
    //   const {scrollTop, scrollLeft, clientWidth, clientHeight} = event.target || {};
    //   from = {x: scrollLeft, y: scrollTop};
    //   to = {x: scrollLeft + clientWidth, y: scrollTop + clientHeight};
    // });
  }
</script>
<script>
  let intervalId
  let count = 0
  let cycleAliveMap
  let pointsToCheck
  const getCycles = (data) => {
    cycleAliveMap = data
    pointsToCheck = getPointsToCheck(cycleAliveMap)
    intervalId = setInterval(() => {
      // cycleAliveMap = getCycle(cycleAliveMap)
      // console.log('cycleAliveMap', cycleAliveMap)
      // console.log('pointsToCheck', pointsToCheck)
      const {
        newAliveMap,
        nextCyclePointsToCheck
      } = getCycle({
        pointsToCheck,
        maxCellCountHeight: heightPx/cellSizePx,
        maxCellCountWidth: widthPx/cellSizePx,
        aliveMap: cycleAliveMap
      })
      pointsToCheck = nextCyclePointsToCheck
      cycleAliveMap = newAliveMap
      console.log('nextCyclePointsToCheck', nextCyclePointsToCheck)
      console.log('newAliveMap', newAliveMap)
      count += 1

      updateGrid({
        from,
        to,
        context: canvasContext,
        dataMap: cycleAliveMap
      });
    }, 100)
  }

  const startGame = () => {
    getCycles(plannerMap)
    // getCycles(gliderMap)
  }
  const stopGame = () => {
    clearInterval(intervalId)
  }

  const updateField = () => {
    // canvasContext = getCanvasContext({width: 1100 || scrollContainer.clientWidth, height: 1100 || scrollContainer.clientHeight})
    canvasContext = getCanvasContext({width: widthPx, height: heightPx})
    // const scrollEl = document.querySelector("#field-area");
    // scrollEl.style.width = `${width * 10}px`
    // scrollEl.style.height = `${height * 10}px`

    from = {x: 0, y: 0}
    to = {x: widthPx, y: heightPx}

    updateGrid({
      from,
      to,
      context: canvasContext
    });
  }
</script>

<div class="life-container">
  <div class="life-options">
    <div class="field-controls">
      <div class="life-controls">
        <button onclick="startGame()">Start life</button>
        <button onclick="stopGame()">Stop life</button>
      </div>
      <div class="forms-of-life">
        <div>Forms of life:</div>
      </div>
      <div class="field-inputs">
        <div>Field options:</div>
        <div class="field-width-input">
          <label for="field-width">Width (px):</label>
          <input id="field-width" name="field-width" type="number" onkeyup="onWidthChange(this)"/>
          <script>
            const onWidthChange = (input) => {
              widthPx = Number(input.value)
            }
            document.getElementById("field-width").value = widthPx;
          </script>
        </div>
        <div class="field-height-input">
          <label for="field-height">Height (px):</label>
          <input id="field-height" name="field-height" type="number" onkeyup="onHeightChange(this)"/>
          <script>
            const onHeightChange = (input) => {
              heightPx = Number(input.value)
            }
            document.getElementById("field-height").value = heightPx;
          </script>
        </div>
        <div class="cell-size-input">
          <label for="cell-size">Cell (px):</label>
          <input id="cell-size" name="cell-size" type="number" onkeyup="onCellSizeChange(this)"/>
          <script>
            const onCellSizeChange = (input) => {
              cellSizePx = Number(input.value)
            }
            document.getElementById("cell-size").value = cellSizePx;
          </script>
        </div>
        <button onclick="updateField()">Apply field size</button>
      </div>
    </div>

  </div>
  <canvas id="canvas"></canvas>
<!--  <div id="scroll-container">-->
<!--    <div id="field-area"></div>-->
<!--  </div>-->
</div>
</body>
</html>
